{% extends "base.html" %}
{% block content %}
<h3 class="mb-4 text-primary">Lista de Alumnos</h3>

<style>
  body {
    font-size: 12px; /* tamaño general */
  }
  table {
    font-size: 14px; /* tamaño dentro de la tabla */
  }
  th {
    font-size: 15px; /* encabezados un poco más grandes */
  }
  td {
    font-size: 13px; /* celdas un poco más pequeñas */
  }
</style>


<div class="accordion" id="accordionAlumnos">
{% for curp, registros in resultados|dictsort %}
    <div class="accordion-item mb-3 shadow-sm border-primary rounded">
        <h2 class="accordion-header" id="heading-{{ curp }}">
            <button class="accordion-button collapsed bg-primary text-white" type="button" data-bs-toggle="collapse" data-bs-target="#collapse-{{ curp }}" aria-expanded="false" aria-controls="collapse-{{ curp }}">
                {{ registros[0]['NOM_COMPLETO'] }}
            </button>
        </h2>
        <div id="collapse-{{ curp }}" class="accordion-collapse collapse" aria-labelledby="heading-{{ curp }}" data-bs-parent="#accordionAlumnos">
            <div class="accordion-body">
                <form method="POST" action="{{ url_for('mostrar_resultados') }}">
                    <input type="hidden" name="curp" value="{{ curp }}">
                    <div class="row row-cols-1 row-cols-md-2 g-3">
                        {% for registro in registros %}
                        <div class="col">
                            <div class="card border-info shadow-sm h-100">
                                <div class="card-body d-flex justify-content-between align-items-center">
                                    <div>
                                        <p class="mb-1"><strong>Ciclo:</strong> {{ registro['CICLO_ESCOLAR'] }}</p>
                                        <p class="mb-1"><strong>Trámite:</strong> {{ registro['TRAMITE'] }}</p>
                                        <p class="mb-0"><strong>Estatus:</strong> 
                                            <span class="{% if registro['ESTATUS_GENERAL'] == 'Becado' %}text-success{% elif registro['ESTATUS_GENERAL'] == 'Rechazo' %}text-danger{% else %}text-warning{% endif %}">
                                                {{ registro['ESTATUS_GENERAL'] }}
                                            </span>
                                        </p>
                                    </div>
                                    <div>
                                        <input type="checkbox" name="ciclos" value="{{ registro['CICLO_ESCOLAR'] }}" checked>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>

                    <!-- Columnas a mostrar -->
                    <div class="mt-2 mb-2">
                        <p><strong>Seleccione columnas a mostrar:</strong></p>
                        <div class="form-check mb-2">
                            <input type="checkbox" class="form-check-input select-all-cols" id="selectAllCols-{{ curp }}" onclick="toggleAllColumns(this)">
                            <label for="selectAllCols-{{ curp }}" class="form-check-label">Seleccionar todas</label>
                        </div>
                        <div class="row">
                            {% for col in columnas_visibles %}
                            <div class="col-md-3 mb-1">
                                <label class="form-check-label">
                                    <input type="checkbox" class="form-check-input columna-checkbox" name="columnas" value="{{ col }}"
                                    {% if col in seleccion_columnas or col in ['NOM_COMPLETO','CICLO_ESCOLAR','ESTATUS_GENERAL'] %}checked{% endif %}
                                    onchange="checkSelectAllStatus(this)">
                                    {{ labels.get(col, col) }}
                                </label>
                            </div>
                            {% endfor %}
                        </div>
                    </div>

                    <div class="mt-3 mb-3">
                        <button type="submit" class="btn btn-success btn-sm">Ver detalle</button>
                        <a href="{{ url_for('buscar_alumno') }}" class="btn btn-secondary btn-sm">Cancelar</a>
                    </div>
                </form>
            </div>
        </div>
    </div>
{% endfor %}
</div>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
function toggleAllColumns(source) {
    const container = source.closest('.accordion-body');
    if (!container) return;
    const checkboxes = container.querySelectorAll('.columna-checkbox');
    checkboxes.forEach(cb => cb.checked = source.checked);
}

function checkSelectAllStatus(el) {
    const container = el.closest('.accordion-body');
    if (!container) return;
    const allCheckboxes = container.querySelectorAll('.columna-checkbox');
    const selectAll = container.querySelector('.select-all-cols');
    if (!selectAll) return;
    selectAll.checked = Array.from(allCheckboxes).every(cb => cb.checked);
}
</script>

{% endblock %}
