{% extends "base.html" %}
{% block content %}
<div class="container mt-4">
    <h2 class="text-primary mb-4">Panel de Administración</h2>

    <!-- Tabla de usuarios -->
    <div class="card shadow-sm mb-4">
        <div class="card-header bg-primary text-white">
            Usuarios registrados
        </div>
        <div class="card-body">
            <table class="table table-bordered table-striped">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Usuario</th>
                        <th>Rol</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    {% for usuario in usuarios %}
                    <tr>
                        <td>{{ usuario['id'] }}</td>
                        <td>{{ usuario['usuario'] }}</td>
                        <td>
                            {% if usuario['rol'] == 'admin' %}
                                <span class="badge bg-danger">Administrador</span>
                            {% else %}
                                <span class="badge bg-secondary">Usuario</span>
                            {% endif %}
                        </td>
                        <td>
                            <a href="{{ url_for('editar_usuario', id=usuario['id']) }}" class="btn btn-sm btn-warning">
                                <i class="bi bi-pencil"></i> Editar
                            </a>
                            <a href="{{ url_for('eliminar_usuario', id=usuario['id']) }}" class="btn btn-sm btn-danger" onclick="return confirm('¿Seguro que deseas eliminar este usuario?')">
                                <i class="bi bi-trash"></i> Eliminar
                            </a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- Formulario para agregar usuario -->
    <div class="card shadow-sm">
        <div class="card-header bg-success text-white">
            Agregar nuevo usuario
        </div>
        <div class="card-body">
            <form method="POST" action="{{ url_for('agregar_usuario') }}">
                <div class="mb-3">
                    <label for="usuario" class="form-label">Nombre de usuario</label>
                    <input type="text" class="form-control" name="usuario" id="usuario" required>
                </div>
                <div class="mb-3">
                    <label for="password" class="form-label">Contraseña</label>
                    <input type="password" class="form-control" name="password" id="password" required>
                </div>
                <div class="mb-3">
                    <label for="rol" class="form-label">Rol</label>
                    <select name="rol" id="rol" class="form-select">
                        <option value="usuario">Usuario</option>
                        <option value="admin">Administrador</option>
                    </select>
                </div>

                <!-- Campos permitidos para usuarios -->
                <div class="mb-3">
                    <label class="form-label">Campos permitidos (además de los obligatorios)</label>
                    <div class="row">
                        <!-- Campos fijos (no se pueden desmarcar) -->
                        <div class="col-md-4">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" checked disabled>
                                <label class="form-check-label">Nom_Completo (Obligatorio)</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" checked disabled>
                                <label class="form-check-label">Ciclo Escolar (Obligatorio)</label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" checked disabled>
                                <label class="form-check-label">ESTATUS GENERAL (Obligatorio)</label>
                            </div>
                        </div>

                        <!-- Campos configurables -->
                        <div class="col-md-8">
                            <div class="row">
                                {% set campos = [
                                    "Orden Nomina","Orden referencia","Idtramite","CURP","ESTATUS BECAS","RFC","NombreSolicitante",
                                    "FechaSol","FechaCita","CveApoyo","Tramite","Monto de Beca","Monto_Letra","Folio","CveDep",
                                    "Dependencia","CveProcedencia","Procedencia","CveSubProcedencia","SubProcedencia","CveEstatus",
                                    "Estatus","CveRazonSocial","Nombres","ApellidoP","ApellidoM","Calle","No Ext","No Int","Colonia",
                                    "CP","Municipio","Teléfono","Correo","Solicitud","Respuesta","Fecha Modificado","Atendio",
                                    "CCT","Nivel","Plantel","SisAAE","Mpio Plantel","Ubicacion Plantel","LATITUD","LONGITUD",
                                    "Turno","Grado","Grupo","Promedio","CURP Solicitante","Sexo","Nombre Alumno",
                                    "Primer Apellido Alumno","Segundo Apellido Alumno","Fecha Nac Alumno","Ingreso Familiar",
                                    "Ocupacion","CURP Papa","Nombre Completo Papa x Nombre","Nombre Completo Papa x Apellido",
                                    "Nombre Papa","Primer Apellido Papa","Segundo Apellido Papa","CURP Mama",
                                    "Nombre Completo Mama x Nombre","Nombre Completo Mama x Apellido","Nombre Mama",
                                    "Primer Apellido Mama","Segundo Apellido Mama","Tarjeta Soluciones","Dia Evento","Nombre_Cobra",
                                    "Primer Ap_Cobra","Segundo Ap_Cobra","NomComp_Cobra","Fila Evento","Municipio Sede",
                                    "Fecha de vigencia","Referencia","1 Estatus Referencia","2 Estaus Referencia","Fecha_mov",
                                    "Referencia2","Estatus Referencia2","Fecha_Mov2","Referencia3","Estatus Referencia3","Fecha_Mov3",
                                    "Ref2_Retorna","Estatus_Ref2 Retorna","Fecha_Ref2 Retorna","Monto de Beca2","Monto_Letra2",
                                    "Ref_Retorna3","Estatus_Ref Retorna3","Fecha_Ref3 Retorna","Tutor","Estatus Final Referencia"
                                ] %}
                                
                                {% for campo in campos %}
                                <div class="col-md-6">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" name="campos_permitidos" value="{{ campo }}">
                                        <label class="form-check-label">{{ campo }}</label>
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>

                <button type="submit" class="btn btn-success">
                    <i class="bi bi-plus-circle"></i> Agregar
                </button>
            </form>
        </div>
    </div>

    <div class="mt-3">
        <a href="{{ url_for('home') }}" class="btn btn-secondary">
            <i class="bi bi-arrow-left-circle"></i> Regresar al inicio
        </a>
    </div>
</div>

<!-- Bootstrap Icons -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
{% endblock %}
