{% extends "base.html" %}
{% block content %}
<div class="container mt-4">
    <h2 class="text-primary mb-4">Editar Usuario</h2>

    <form method="POST">
        <div class="mb-3">
            <label for="usuario" class="form-label">Nombre de usuario</label>
            <input type="text" class="form-control" id="usuario" name="usuario"
                   value="{{ usuario['usuario'] }}" required>
        </div>

        <div class="mb-3">
            <label for="password" class="form-label">Contraseña</label>
            <input type="password" class="form-control" id="password" name="password"
                   value="{{ usuario['password'] }}" required>
        </div>

        <div class="mb-3">
            <label for="rol" class="form-label">Rol</label>
            <select id="rol" name="rol" class="form-select">
                <option value="usuario" {% if usuario['rol'] == 'usuario' %}selected{% endif %}>Usuario</option>
                <option value="admin" {% if usuario['rol'] == 'admin' %}selected{% endif %}>Administrador</option>
            </select>
        </div>

        {% if usuario['rol'] == 'usuario' %}
        <div class="mb-3">
            <label class="form-label">Campos permitidos</label>
            <div class="row">
                {# Default fields si no hay nada guardado #}
                {% set default_fields = ['NOM_COMPLETO', 'CICLO_ESCOLAR', 'ESTATUS_GENERAL'] %}
                {% if usuario['campos_permitidos'] %}
                    {% set campos_seleccionados = usuario['campos_permitidos'].split(',') %}
                {% else %}
                    {% set campos_seleccionados = default_fields %}
                {% endif %}

                {% for campo in [
                    "Orden Nomina","Orden referencia","Idtramite","CURP","ESTATUS BECAS",
                    "ESTATUS GENERAL","RFC","NombreSolicitante","Nom_Completo","FechaSol",
                    "FechaCita","CveApoyo","Tramite","Monto de Beca","Monto_Letra","Folio",
                    "CveDep","Dependencia","CveProcedencia","Procedencia","CveSubProcedencia",
                    "SubProcedencia","CveEstatus","Estatus","CveRazonSocial","Nombres",
                    "ApellidoP","ApellidoM","Calle","No Ext","No Int","Colonia","CP",
                    "Municipio","Teléfono","Correo","Solicitud","Respuesta","Fecha Modificado",
                    "Atendio","Ciclo Escolar","CCT","Nivel","Plantel","SisAAE","Mpio Plantel",
                    "Ubicacion Plantel","LATITUD","LONGITUD","Turno","Grado","Grupo","Promedio",
                    "CURP Solicitante","Sexo","Nombre Alumno","Primer Apellido Alumno",
                    "Segundo Apellido Alumno","Fecha Nac Alumno","Ingreso Familiar","Ocupacion",
                    "CURP Papa","Nombre Completo Papa x Nombre","Nombre Completo Papa x Apellido",
                    "Nombre Papa","Primer Apellido Papa","Segundo Apellido Papa","CURP Mama",
                    "Nombre Completo Mama x Nombre","Nombre Completo Mama x Apellido","Nombre Mama",
                    "Primer Apellido Mama","Segundo Apellido Mama","Tarjeta Soluciones","Dia Evento",
                    "Nombre_Cobra","Primer Ap_Cobra","Segundo Ap_Cobra","NomComp_Cobra","Fila Evento",
                    "Municipio Sede","Fecha de vigencia","Referencia","1 Estatus Referencia",
                    "2 Estaus Referencia","Fecha_mov","Referencia2","Estatus Referencia2","Fecha_Mov2",
                    "Referencia3","Estatus_Ref Retorna3","Fecha_Ref3 Retorna","Ref2_Retorna",
                    "Estatus_Ref2 Retorna","Fecha_Ref2 Retorna","Monto de Beca2","Monto_Letra2",
                    "Ref_Retorna3","Estatus_Ref Retorna3","Fecha_Ref3 Retorna","Tutor","Estatus Final Referencia"
                ] %}
                <div class="form-check col-md-4">
                    <input class="form-check-input" type="checkbox" 
                           name="campos_permitidos" value="{{ campo }}" 
                           id="campo_{{ loop.index }}"
                           {% if campo in campos_seleccionados %}checked{% endif %}>
                    <label class="form-check-label" for="campo_{{ loop.index }}">{{ campo }}</label>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}

        <button type="submit" class="btn btn-success">
            <i class="bi bi-save"></i> Guardar cambios
        </button>

        <a href="{{ url_for('admin_panel') }}" class="btn btn-secondary">
            <i class="bi bi-arrow-left-circle"></i> Regresar
        </a>
    </form>

    <!-- Espaciador para evitar que el botón quede oculto -->
    <div class="mb-5"></div>
</div>

<!-- Bootstrap Icons -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">

<style>
/* Asegura que haya espacio extra para el botón */
body {
    padding-bottom: 100px;
}
</style>
{% endblock %}
